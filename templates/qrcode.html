{% extends "base.html" %}

{% block title %}QR Code{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='qr.css') }}">

<div class="container qr-code-container">
    <h2>QR Code</h2>
    <div id="qr-code-section">
        <p>Escaneie o QR Code abaixo para acessar sua conta ou informações:</p>
        <div id="qr-code-display">
            <!-- Mensagem inicial -->
            <p id="loading-message">Gerando QR Code, por favor aguarde...</p>
        </div>
    </div>
    <div id="error-message" class="error"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async function () {
        const qrDisplay = document.getElementById('qr-code-display');
        const errorMessage = document.getElementById('error-message');
        const loadingMessage = document.getElementById('loading-message');

        try {
            // Faz a requisição ao Flask para obter o QR Code
            const response = await fetch('/gerar_qr');
            if (!response.ok) throw new Error("Erro ao obter o QR Code");

            const data = await response.json();

            // Exibe o QR Code se retornado com sucesso
            if (data.qr_code) {
                qrDisplay.innerHTML = `<img src="${data.qr_code}" alt="QR Code gerado" class="qr-code-image">`;
            } else {
                throw new Error("QR Code não encontrado na resposta.");
            }
        } catch (error) {
            // Exibe mensagem de erro se algo der errado
            errorMessage.innerText = "Erro ao carregar o QR Code. Tente novamente mais tarde.";
            qrDisplay.innerHTML = "";
            console.error("Detalhes do erro:", error.message);
        } finally {
            // Remove a mensagem de carregamento
            if (loadingMessage) loadingMessage.remove();
        }
    });
</script>
{% endblock %}
